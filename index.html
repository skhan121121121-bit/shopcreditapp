<!DOCTYPE html>
<html>
<head>
  <title>Shop Credit App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <script type="module">

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } 
    from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // ðŸ”¥ à¦¤à§‹à¦®à¦¾à¦° Firebase Config à¦à¦–à¦¾à¦¨à§‡ à¦¬à¦¸à¦¾à¦“
    const firebaseConfig = {
      apiKey: "AIzaSyB0xBi2JBcgJ54gRPqZC0UFxL2VAECyQzk",
      authDomain: "shopcreditapp.firebaseapp.com",
      projectId: "shopcreditapp",
      storageBucket: "shopcreditapp.appspot.com",
      messagingSenderId: "594237813147",
      appId: "1:594237813147:web:8164b35b8fa4985376713e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const shopId = "shop_001"; // Screenshot à¦…à¦¨à§à¦¯à¦¾à¦¯à¦¼à§€

    // âœ… ADD CUSTOMER
    window.addCustomer = async function() {

      const name = document.getElementById("name").value;
      const mobile = document.getElementById("mobile").value;
      const due = Number(document.getElementById("due").value);

      if(!name || !mobile || !due){
        alert("à¦¸à¦¬ à¦«à¦¿à¦²à§à¦¡ à¦ªà§‚à¦°à¦£ à¦•à¦°à§à¦¨");
        return;
      }

      await addDoc(
        collection(db, "shops", shopId, "customers"),
        {
          name: name,
          mobile: mobile,
          totalDue: due,
          createdAt: new Date()
        }
      );

      document.getElementById("name").value="";
      document.getElementById("mobile").value="";
      document.getElementById("due").value="";

      loadCustomers();
    }

    // âœ… LOAD CUSTOMER
    async function loadCustomers(){

      const querySnapshot = await getDocs(
        collection(db, "shops", shopId, "customers")
      );

      let html="";
      let total=0;

      querySnapshot.forEach((docSnap)=>{

        const data = docSnap.data();
        total += Number(data.totalDue);

        html += `
          <div style="border:1px solid #ccc;padding:10px;margin:5px">
            <b>${data.name}</b><br>
            ${data.mobile}<br>
            Due: â‚¹ ${data.totalDue}<br>
            <button onclick="deleteCustomer('${docSnap.id}')">
              Delete
            </button>
          </div>
        `;
      });

      document.getElementById("customerList").innerHTML = html;
      document.getElementById("totalDue").innerText = "â‚¹ " + total;
    }

    // âœ… DELETE
    window.deleteCustomer = async function(id){

      await deleteDoc(
        doc(db, "shops", shopId, "customers", id)
      );

      loadCustomers();
    }

    // Auto Load
    window.onload = loadCustomers;

  </script>
</head>

<body style="font-family:Arial;padding:20px">

<h2>Shop Credit System</h2>

<input type="text" id="name" placeholder="Customer Name"><br><br>
<input type="text" id="mobile" placeholder="Mobile"><br><br>
<input type="number" id="due" placeholder="Due Amount"><br><br>

<button onclick="addCustomer()">Add Customer</button>

<h3>Total Due: <span id="totalDue">â‚¹ 0</span></h3>

<div id="customerList"></div>

</body>
</html>
